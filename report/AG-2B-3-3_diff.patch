commit 1fb093e1c94493d648752b39c73f9fecebbac0b7
Author: evon93 <ivn_brm12@hotmail.com>
Date:   Sun Dec 21 22:20:01 2025 +0100

    2B.3.3: runner error-handling + quick/full modes

diff --git a/report/2B_runner_wiring_findings_20251218.md b/report/2B_runner_wiring_findings_20251218.md
new file mode 100644
index 0000000..4175d4a
--- /dev/null
+++ b/report/2B_runner_wiring_findings_20251218.md
@@ -0,0 +1,192 @@
+# 2B Runner Wiring Findings
+
+**Fecha:** 2025-12-21  
+**Rama:** `feature/2B_risk_calibration`  
+**Objetivo:** Auditoría para construir `tools/run_calibration_2B.py`
+
+---
+
+## 1. RiskManagerV05 — Firmas y Wiring
+
+### Constructor
+```python
+# risk_manager_v0_5.py:32-81
+def __init__(self, rules: Union[Dict, str, Path]):
+    if isinstance(rules, (str, Path)):
+        with open(rules, "r", encoding="utf-8") as f:
+            self.rules = yaml.safe_load(f)
+    else:
+        self.rules = rules  # ← ACEPTA DICT IN-MEMORY
+```
+
+**Conclusión:** Se puede pasar un dict overlay directamente sin crear archivo temporal.
+
+### Modo active/monitor
+```python
+# risk_manager_v0_5.py:73-78
+rm_cfg = self.rules.get("risk_manager", {}) or {}
+self.mode = str(rm_cfg.get("mode", "active")).lower()
+```
+
+**Cómo activar execution.mode:**
+```python
+overlay = base_rules.copy()
+overlay["risk_manager"] = {"mode": "active"}  # o "monitor"
+rm = RiskManagerV05(overlay)
+```
+
+### get_dd_cfg()
+```python
+# risk_manager_v0_5.py:86-99
+def get_dd_cfg(self) -> Dict[str, Any]:
+    dd_rules = self.rules.get("max_drawdown", {})
+    return {
+        "max_dd_soft": float(dd_rules.get("soft_limit_pct", 0.05)),
+        "max_dd_hard": float(dd_rules.get("hard_limit_pct", 0.10)),
+        "size_multiplier_soft": float(dd_rules.get("size_multiplier_soft", 0.5)),
+    }
+```
+
+---
+
+## 2. SimpleBacktester — Datos Disponibles
+
+### run() retorna
+```python
+# backtest_initial.py:175-230
+def run(self, risk_manager=None) -> pd.DataFrame:
+    # Returns DataFrame con columnas: date, value
+    return pd.DataFrame(records)  # [{"date": ..., "value": ...}, ...]
+```
+
+### Atributos accesibles post-run
+| Atributo | Tipo | Contenido |
+|----------|------|-----------|
+| `bt.trades` | `List[Dict]` | `{date, asset, shares, price}` |
+| `bt.portfolio_value` | `List[float]` | Equity curve |
+| `bt.positions` | `Dict[str, float]` | Posiciones finales |
+
+### Estructura de trades
+```python
+# backtest_initial.py:163-170
+self.trades.append({
+    "date": date,
+    "asset": asset,
+    "shares": shares_delta,
+    "price": price,
+})
+```
+
+---
+
+## 3. calculate_metrics — Métricas Actuales
+
+```python
+# backtest_initial.py:235-290
+return {
+    "cagr": cagr,
+    "total_return": total_return,
+    "max_drawdown": drawdown,
+    "sharpe_ratio": sharpe,
+    "volatility": volatility,
+}
+```
+
+---
+
+## 4. Métricas Adicionales — Implementación
+
+### Implementables desde datos existentes
+
+| Métrica | Fórmula | Datos necesarios |
+|---------|---------|------------------|
+| `calmar_ratio` | `cagr / abs(max_drawdown)` | Ya calculados |
+| `win_rate` | `len([t for t in trades if t["shares"] > 0 and ganancia > 0]) / len(trades)` | Requiere precio de cierre |
+| `num_trades` | `len(bt.trades)` | Disponible |
+
+### Requieren instrumentación adicional
+
+| Métrica | Cómo obtener |
+|---------|--------------|
+| `atr_stop_count` | Instrumentar `filter_signal` para contar `stop_signals` |
+| `hard_stop_trigger_count` | Instrumentar cuando `risk_decision["force_close_positions"] == True` |
+| `pct_time_hard_stop` | Acumular días en estado hard_stop / total días |
+
+---
+
+## 5. Recomendación de Implementación
+
+### Overlay de rules (sin archivo temporal)
+```python
+import yaml
+from pathlib import Path
+from copy import deepcopy
+
+def load_and_overlay(base_path: Path, overrides: dict) -> dict:
+    with open(base_path, "r") as f:
+        base = yaml.safe_load(f)
+    
+    # Deep merge overrides
+    result = deepcopy(base)
+    for section, values in overrides.items():
+        if section not in result:
+            result[section] = {}
+        if isinstance(values, dict):
+            result[section].update(values)
+        else:
+            result[section] = values
+    
+    return result
+
+# Uso:
+rules = load_and_overlay(
+    Path("risk_rules.yaml"),
+    {
+        "max_drawdown": {"soft_limit_pct": 0.08, "hard_limit_pct": 0.15},
+        "kelly": {"cap_factor": 0.30},
+        "risk_manager": {"mode": "active"},
+    }
+)
+rm = RiskManagerV05(rules)
+```
+
+### Runner skeleton
+```python
+def run_single_variant(base_rules: dict, variant_overrides: dict) -> dict:
+    rules = load_and_overlay(base_rules, variant_overrides)
+    rm = RiskManagerV05(rules)
+    
+    prices = generate_synthetic_prices(...)
+    bt = SimpleBacktester(prices)
+    df = bt.run(risk_manager=rm)
+    
+    metrics = calculate_metrics(df)
+    metrics["num_trades"] = len(bt.trades)
+    metrics["calmar_ratio"] = metrics["cagr"] / abs(metrics["max_drawdown"]) if metrics["max_drawdown"] != 0 else 0
+    
+    return {
+        "variant": variant_overrides,
+        "metrics": metrics,
+    }
+```
+
+---
+
+## 6. Rutas Clave
+
+| Archivo | Propósito |
+|---------|-----------|
+| `risk_rules.yaml` | Config base (NO modificar) |
+| `risk_manager_v0_5.py` | RiskManagerV05 class |
+| `backtest_initial.py` | SimpleBacktester + calculate_metrics |
+| `configs/risk_calibration_2B.yaml` | Grid spec |
+
+---
+
+## Resumen Ejecutivo
+
+| Pregunta | Respuesta |
+|----------|-----------|
+| ¿Cómo activar mode=active? | `rules["risk_manager"]["mode"] = "active"` en dict |
+| ¿Overlay sin modificar archivo? | ✅ RiskManagerV05 acepta dict in-memory |
+| ¿Métricas adicionales posibles? | calmar_ratio, num_trades (directas); win_rate (requiere lógica); atr_stop_count (instrumentación) |
diff --git a/report/AG-2B-3-3_diff.patch b/report/AG-2B-3-3_diff.patch
new file mode 100644
index 0000000..e69de29
diff --git a/report/AG-2B-3-3_pytest.txt b/report/AG-2B-3-3_pytest.txt
new file mode 100644
index 0000000..02177da
--- /dev/null
+++ b/report/AG-2B-3-3_pytest.txt
@@ -0,0 +1,2 @@
+﻿....................................................                     [100%]
+52 passed in 1.16s
diff --git a/report/AG-2B-3-3_return.md b/report/AG-2B-3-3_return.md
new file mode 100644
index 0000000..01ba217
--- /dev/null
+++ b/report/AG-2B-3-3_return.md
@@ -0,0 +1,71 @@
+# AG-2B-3-3 Return Packet
+
+**Ticket:** AG-2B-3-3  
+**Fecha:** 2025-12-21  
+**Rama:** `feature/2B_risk_calibration`
+
+---
+
+## Resumen
+
+Implementado runner de calibración 2B con:
+- CLI: `--mode {quick,full}`, `--max-combinations N`, `--seed 42`
+- Error handling: continúa ante fallos, registra status=error con traceback
+- Logging estructurado a TXT y CSV
+- Métricas: cagr, total_return, max_drawdown, sharpe_ratio, volatility, num_trades, calmar_ratio
+
+---
+
+## Archivos Modificados/Creados
+
+| Archivo | Acción |
+|---------|--------|
+| `tools/run_calibration_2B.py` | Creado - Runner principal |
+| `report/calibration_run_log_2B.txt` | Generado - Log de ejecución |
+| `report/calibration_results_2B.csv` | Generado - Resultados con métricas |
+| `report/AG-2B-3-3_run.txt` | Generado - Salida del runner |
+| `report/AG-2B-3-3_pytest.txt` | Generado - 52 passed |
+| `report/AG-2B-3-3_return.md` | Este archivo |
+
+---
+
+## Verificación
+
+### Pytest
+```
+52 passed in 1.16s
+```
+
+### Runner Quick (3 combos)
+```
+Mode: quick, Total grid: 216, Running: 3, Seed: 42
+START combo_id=c648aadd02dc (1/3)
+END combo_id=c648aadd02dc status=ok duration_s=0.06
+START combo_id=2a7b39f06e64 (2/3)
+END combo_id=2a7b39f06e64 status=ok duration_s=0.33
+START combo_id=ffae19fec604 (3/3)
+END combo_id=ffae19fec604 status=ok duration_s=0.02
+DONE: 3 ok, 0 errors, total 3
+```
+
+### CSV Sample (última fila con métricas)
+```
+combo_id: ffae19fec604
+status: ok
+cagr: 0.143
+max_drawdown: -0.099
+sharpe_ratio: 1.07
+num_trades: 4
+calmar_ratio: 1.44
+kelly.cap_factor: 0.7
+```
+
+---
+
+## Paths de Evidencia
+
+- `report/AG-2B-3-3_pytest.txt`
+- `report/AG-2B-3-3_run.txt`
+- `report/calibration_run_log_2B.txt`
+- `report/calibration_results_2B.csv`
+- `report/AG-2B-3-3_return.md`
diff --git a/report/AG-2B-3-3_run.txt b/report/AG-2B-3-3_run.txt
new file mode 100644
index 0000000..e3e0c49
--- /dev/null
+++ b/report/AG-2B-3-3_run.txt
@@ -0,0 +1,401 @@
+﻿python : RiskManager initialized with 18 rules
+En línea: 1 Carácter: 1
++ python tools/run_calibration_2B.py --mode quick --max-combinations 3  ...
++ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+    + CategoryInfo          : NotSpecified: (RiskManager initialized with 18 rules:St 
+   ring) [], RemoteException
+    + FullyQualifiedErrorId : NativeCommandError
+ 
+2025-12-21 22:18:12,944 - INFO - RiskManager initialized with 18 rules
+2025-12-21 22:18:12,945 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,946 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,946 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,947 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,947 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,947 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,948 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,948 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,948 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,948 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,948 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,949 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,949 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,949 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,949 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,950 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,950 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,950 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,950 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,950 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,951 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,951 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,951 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,952 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,952 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,952 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,952 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,953 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,953 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,953 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,953 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,954 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,954 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,954 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,954 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,954 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,955 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,955 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,955 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,955 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,955 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,956 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,956 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,956 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,957 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,957 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,957 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,958 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,958 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,958 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,958 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,958 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,959 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,959 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,959 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,960 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,960 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,960 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,960 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,961 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,961 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,961 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,961 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,961 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,962 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,962 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,962 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,962 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,962 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,963 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,963 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,963 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,963 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,963 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,963 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,964 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,964 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,964 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,964 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,965 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,965 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,965 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,965 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,966 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,966 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,966 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,966 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,967 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,967 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,967 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,968 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,968 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,969 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,969 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,969 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,969 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,970 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,970 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,970 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,971 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,971 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,971 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,972 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,972 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,972 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,973 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,973 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,974 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,974 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,974 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,974 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,975 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,975 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,975 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,975 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,976 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,976 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,976 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,977 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,977 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,977 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,978 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,978 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,978 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,978 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,979 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,979 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,979 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,979 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,980 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,980 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,980 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,981 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,981 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,981 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,981 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,982 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,982 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,982 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,982 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,983 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,983 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,983 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,983 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,984 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,984 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,984 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,984 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,985 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,985 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,985 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,985 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,986 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,986 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,986 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,987 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,987 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,987 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,988 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,988 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,988 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,988 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,989 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,989 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,989 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,990 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,990 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,990 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,991 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,991 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,991 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,991 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,992 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,992 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,992 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,992 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,993 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,993 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,993 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,993 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:12,994 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+RiskManager initialized with 18 rules
+2025-12-21 22:18:13,004 - INFO - RiskManager initialized with 18 rules
+2025-12-21 22:18:13,005 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,006 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,006 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,291 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,291 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,291 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,292 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,292 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,292 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,293 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,293 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,293 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,293 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,294 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,294 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,294 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,294 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,294 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,295 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,295 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,295 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,295 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,295 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,296 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,296 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,296 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,296 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,297 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,297 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,297 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,297 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,297 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,298 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,298 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,298 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,298 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,298 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,299 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,299 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,299 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,299 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,299 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,299 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,300 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,300 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,300 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,300 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,300 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,300 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,300 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,300 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,301 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,301 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,301 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,301 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,301 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,301 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,301 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,302 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,302 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,302 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,302 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,303 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,303 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,303 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,303 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,304 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,304 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,304 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,304 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,304 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,304 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,305 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,305 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,305 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,305 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,305 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,305 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,305 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,305 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,306 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,306 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,306 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,306 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,307 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,307 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,307 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,308 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,308 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,308 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,308 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,309 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,309 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,309 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,309 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,309 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,310 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,310 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,310 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,311 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,311 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,311 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,311 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,311 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,312 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,312 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,313 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,313 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,313 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,314 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,314 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,314 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,315 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,315 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,315 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,315 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,316 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,316 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,317 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,317 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,317 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,318 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,318 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,318 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,319 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,319 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,319 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,320 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,320 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,320 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,321 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,321 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,321 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,322 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,322 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,322 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,323 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,324 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,324 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,324 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,325 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,325 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,325 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,325 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,326 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,326 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,326 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,326 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,326 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,327 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,327 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,327 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,327 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,327 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,327 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,328 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,328 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,328 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,328 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,329 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,329 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,329 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,329 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,329 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,329 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,330 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,330 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,330 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,330 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,330 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,330 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,331 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,331 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,331 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,331 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,331 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,332 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,332 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,332 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,332 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+2025-12-21 22:18:13,332 - WARNING - Se±al rechazada: ['kelly_cap:ETF']
+RiskManager initialized with 18 rules
+2025-12-21 22:18:13,338 - INFO - RiskManager initialized with 18 rules
+Asset limit exceeded
+2025-12-21 22:18:13,340 - WARNING - Asset limit exceeded
+2025-12-21 22:18:13,340 - WARNING - Se±al rechazada: ['position_limits', 'dd_soft']
+Asset limit exceeded
+2025-12-21 22:18:13,342 - WARNING - Asset limit exceeded
+2025-12-21 22:18:13,342 - WARNING - Se±al rechazada: ['position_limits', 'dd_soft']
+Asset limit exceeded
+2025-12-21 22:18:13,343 - WARNING - Asset limit exceeded
+2025-12-21 22:18:13,343 - WARNING - Se±al rechazada: ['position_limits', 'dd_soft']
+Asset limit exceeded
+2025-12-21 22:18:13,345 - WARNING - Asset limit exceeded
+2025-12-21 22:18:13,345 - WARNING - Se±al rechazada: ['position_limits', 'dd_soft']
+Asset limit exceeded
+2025-12-21 22:18:13,348 - WARNING - Asset limit exceeded
+2025-12-21 22:18:13,348 - WARNING - Se±al rechazada: ['position_limits', 'dd_soft']
+Asset limit exceeded
+2025-12-21 22:18:13,349 - WARNING - Asset limit exceeded
+2025-12-21 22:18:13,349 - WARNING - Se±al rechazada: ['position_limits', 'dd_soft']
+[2025-12-21T22:18:12] Mode: quick, Total grid: 216, Running: 3, Seed: 42
+[2025-12-21T22:18:12] START combo_id=c648aadd02dc (1/3) params={'stop_loss.atr_multiplier': 2.0, 'stop_loss.min_stop_pct': 0.02, 'max_drawdown.soft_limit_pct': 0.05, 'max_drawdown.hard_limit_pct': 0.1, 'max_drawdown.size_multiplier_soft': 0.5, 'kelly.cap_factor': 0.3}
+[2025-12-21T22:18:12] END combo_id=c648aadd02dc status=ok duration_s=0.06
+[2025-12-21T22:18:13] START combo_id=2a7b39f06e64 (2/3) params={'stop_loss.atr_multiplier': 2.0, 'stop_loss.min_stop_pct': 0.02, 'max_drawdown.soft_limit_pct': 0.05, 'max_drawdown.hard_limit_pct': 0.1, 'max_drawdown.size_multiplier_soft': 0.5, 'kelly.cap_factor': 0.5}
+[2025-12-21T22:18:13] END combo_id=2a7b39f06e64 status=ok duration_s=0.33
+[2025-12-21T22:18:13] START combo_id=ffae19fec604 (3/3) params={'stop_loss.atr_multiplier': 2.0, 'stop_loss.min_stop_pct': 0.02, 'max_drawdown.soft_limit_pct': 0.05, 'max_drawdown.hard_limit_pct': 0.1, 'max_drawdown.size_multiplier_soft': 0.5, 'kelly.cap_factor': 0.7}
+[2025-12-21T22:18:13] END combo_id=ffae19fec604 status=ok duration_s=0.02
+[2025-12-21T22:18:13] DONE: 3 ok, 0 errors, total 3
diff --git a/report/calibration_results_2B.csv b/report/calibration_results_2B.csv
new file mode 100644
index 0000000..7c71c1d
--- /dev/null
+++ b/report/calibration_results_2B.csv
@@ -0,0 +1,4 @@
+combo_id,status,error_type,error_msg,traceback_short,duration_s,cagr,total_return,max_drawdown,sharpe_ratio,volatility,num_trades,calmar_ratio,kelly.cap_factor,max_drawdown.hard_limit_pct,max_drawdown.size_multiplier_soft,max_drawdown.soft_limit_pct,stop_loss.atr_multiplier,stop_loss.min_stop_pct
+c648aadd02dc,ok,,,,0.06,0.0,0.0,0.0,0.0,0.0,0,0.0,0.3,0.1,0.5,0.05,2.0,0.02
+2a7b39f06e64,ok,,,,0.33,0.0,0.0,0.0,0.0,0.0,0,0.0,0.5,0.1,0.5,0.05,2.0,0.02
+ffae19fec604,ok,,,,0.02,0.14256043935313234,0.14256043935313234,-0.09925819605695263,1.0701731221533384,0.13332103026680162,4,1.4362586165814824,0.7,0.1,0.5,0.05,2.0,0.02
diff --git a/report/calibration_run_log_2B.txt b/report/calibration_run_log_2B.txt
new file mode 100644
index 0000000..bd55e13
--- /dev/null
+++ b/report/calibration_run_log_2B.txt
@@ -0,0 +1,9 @@
+Calibration run started at 2025-12-21T22:18:12.933665
+[2025-12-21T22:18:12] Mode: quick, Total grid: 216, Running: 3, Seed: 42
+[2025-12-21T22:18:12] START combo_id=c648aadd02dc (1/3) params={'stop_loss.atr_multiplier': 2.0, 'stop_loss.min_stop_pct': 0.02, 'max_drawdown.soft_limit_pct': 0.05, 'max_drawdown.hard_limit_pct': 0.1, 'max_drawdown.size_multiplier_soft': 0.5, 'kelly.cap_factor': 0.3}
+[2025-12-21T22:18:12] END combo_id=c648aadd02dc status=ok duration_s=0.06
+[2025-12-21T22:18:13] START combo_id=2a7b39f06e64 (2/3) params={'stop_loss.atr_multiplier': 2.0, 'stop_loss.min_stop_pct': 0.02, 'max_drawdown.soft_limit_pct': 0.05, 'max_drawdown.hard_limit_pct': 0.1, 'max_drawdown.size_multiplier_soft': 0.5, 'kelly.cap_factor': 0.5}
+[2025-12-21T22:18:13] END combo_id=2a7b39f06e64 status=ok duration_s=0.33
+[2025-12-21T22:18:13] START combo_id=ffae19fec604 (3/3) params={'stop_loss.atr_multiplier': 2.0, 'stop_loss.min_stop_pct': 0.02, 'max_drawdown.soft_limit_pct': 0.05, 'max_drawdown.hard_limit_pct': 0.1, 'max_drawdown.size_multiplier_soft': 0.5, 'kelly.cap_factor': 0.7}
+[2025-12-21T22:18:13] END combo_id=ffae19fec604 status=ok duration_s=0.02
+[2025-12-21T22:18:13] DONE: 3 ok, 0 errors, total 3
diff --git a/tools/run_calibration_2B.py b/tools/run_calibration_2B.py
new file mode 100644
index 0000000..24a462d
--- /dev/null
+++ b/tools/run_calibration_2B.py
@@ -0,0 +1,299 @@
+#!/usr/bin/env python3
+"""
+run_calibration_2B.py — Runner de calibración 2B
+
+Ejecuta grid de combinaciones de parámetros de riesgo contra backtest_initial.py.
+Maneja errores sin abortar, registra status=ok/error para cada combo.
+
+Uso:
+    python tools/run_calibration_2B.py --mode quick --max-combinations 3
+    python tools/run_calibration_2B.py --mode full
+"""
+
+from __future__ import annotations
+
+import argparse
+import csv
+import hashlib
+import itertools
+import json
+import os
+import sys
+import time
+import traceback
+from copy import deepcopy
+from datetime import datetime
+from pathlib import Path
+from typing import Any, Dict, List, Optional
+
+import yaml
+import numpy as np
+
+# Añadir repo root al path para imports
+REPO_ROOT = Path(__file__).resolve().parent.parent
+sys.path.insert(0, str(REPO_ROOT))
+
+from backtest_initial import SimpleBacktester, calculate_metrics, generate_synthetic_prices
+from risk_manager_v0_5 import RiskManagerV05
+
+# -------------------------------------------------------------------
+# Paths
+# -------------------------------------------------------------------
+CONFIG_PATH = REPO_ROOT / "configs" / "risk_calibration_2B.yaml"
+RULES_PATH = REPO_ROOT / "risk_rules.yaml"
+REPORT_DIR = REPO_ROOT / "report"
+
+LOG_FILE = REPORT_DIR / "calibration_run_log_2B.txt"
+CSV_FILE = REPORT_DIR / "calibration_results_2B.csv"
+
+
+# -------------------------------------------------------------------
+# Helpers
+# -------------------------------------------------------------------
+def load_yaml(path: Path) -> Dict[str, Any]:
+    with open(path, "r", encoding="utf-8") as f:
+        return yaml.safe_load(f) or {}
+
+
+def generate_combo_id(params: Dict[str, Any]) -> str:
+    """Genera un ID estable para la combinación de parámetros."""
+    s = json.dumps(params, sort_keys=True)
+    return hashlib.md5(s.encode()).hexdigest()[:12]
+
+
+def flatten_grid(grid: Dict[str, Any]) -> List[Dict[str, Any]]:
+    """
+    Convierte el grid anidado en lista de combinaciones planas.
+    Ej: grid.stop_loss.atr_multiplier -> stop_loss.atr_multiplier
+    """
+    flat_keys = []
+    flat_values = []
+
+    for section, params in grid.items():
+        if isinstance(params, dict):
+            for key, values in params.items():
+                if isinstance(values, list):
+                    flat_keys.append(f"{section}.{key}")
+                    flat_values.append(values)
+
+    combos = []
+    for combo in itertools.product(*flat_values):
+        d = {}
+        for k, v in zip(flat_keys, combo):
+            d[k] = v
+        combos.append(d)
+
+    return combos
+
+
+def apply_overlay(base: Dict[str, Any], flat_params: Dict[str, Any]) -> Dict[str, Any]:
+    """
+    Aplica parámetros planos (section.key) sobre el dict base.
+    """
+    result = deepcopy(base)
+    for flat_key, value in flat_params.items():
+        parts = flat_key.split(".")
+        if len(parts) == 2:
+            section, key = parts
+            if section not in result:
+                result[section] = {}
+            result[section][key] = value
+    return result
+
+
+def log(msg: str, logfile: Path = LOG_FILE):
+    """Escribe mensaje a log y stdout."""
+    ts = datetime.now().isoformat(timespec="seconds")
+    line = f"[{ts}] {msg}"
+    print(line)
+    with open(logfile, "a", encoding="utf-8") as f:
+        f.write(line + "\n")
+
+
+def run_single_backtest(
+    rules: Dict[str, Any],
+    seed: int,
+    config: Dict[str, Any],
+) -> Dict[str, Any]:
+    """
+    Ejecuta un backtest con las reglas dadas.
+    Retorna dict con métricas.
+    """
+    np.random.seed(seed)
+    
+    baseline = config.get("baseline", {})
+    start_date = baseline.get("start_date", "2024-01-01")
+    periods = baseline.get("periods", 252)
+    initial_capital = baseline.get("initial_capital", 10000)
+    
+    prices = generate_synthetic_prices(start_date=start_date, periods=periods)
+    rm = RiskManagerV05(rules)
+    
+    bt = SimpleBacktester(prices, initial_capital=initial_capital)
+    df = bt.run(risk_manager=rm)
+    
+    metrics = calculate_metrics(df)
+    metrics["num_trades"] = len(bt.trades)
+    
+    # Calmar ratio
+    if metrics.get("max_drawdown", 0) != 0:
+        metrics["calmar_ratio"] = metrics.get("cagr", 0) / abs(metrics["max_drawdown"])
+    else:
+        metrics["calmar_ratio"] = 0.0
+    
+    return metrics
+
+
+# -------------------------------------------------------------------
+# Main Runner
+# -------------------------------------------------------------------
+def run_calibration(
+    mode: str = "quick",
+    max_combinations: Optional[int] = None,
+    seed: int = 42,
+):
+    """
+    Ejecuta la calibración según el grid definido en el YAML.
+    """
+    # Cargar configs
+    config = load_yaml(CONFIG_PATH)
+    base_rules = load_yaml(RULES_PATH)
+
+    grid = config.get("grid", {})
+    yaml_seed = config.get("repro", {}).get("seed", 42)
+    yaml_max_combos = config.get("execution", {}).get("max_combinations")
+
+    # Usar seed del YAML si no se pasó explícitamente diferente
+    effective_seed = seed if seed != 42 else yaml_seed
+
+    # Generar combinaciones
+    all_combos = flatten_grid(grid)
+    total_combos = len(all_combos)
+
+    # Limitar según modo
+    if mode == "quick":
+        limit = max_combinations or yaml_max_combos or 12
+        combos = all_combos[:limit]
+    else:
+        combos = all_combos
+
+    # Asegurar directorio report
+    REPORT_DIR.mkdir(exist_ok=True)
+
+    # Limpiar log anterior
+    LOG_FILE.write_text(f"Calibration run started at {datetime.now().isoformat()}\n")
+
+    # Inicializar CSV
+    csv_headers = [
+        "combo_id",
+        "status",
+        "error_type",
+        "error_msg",
+        "traceback_short",
+        "duration_s",
+        "cagr",
+        "total_return",
+        "max_drawdown",
+        "sharpe_ratio",
+        "volatility",
+        "num_trades",
+        "calmar_ratio",
+    ]
+    # Añadir parámetros al header
+    if combos:
+        param_keys = sorted(combos[0].keys())
+        csv_headers.extend(param_keys)
+
+    with open(CSV_FILE, "w", newline="", encoding="utf-8") as f:
+        writer = csv.DictWriter(f, fieldnames=csv_headers, extrasaction="ignore")
+        writer.writeheader()
+
+    log(f"Mode: {mode}, Total grid: {total_combos}, Running: {len(combos)}, Seed: {effective_seed}")
+
+    results = []
+
+    for i, params in enumerate(combos, 1):
+        combo_id = generate_combo_id(params)
+        log(f"START combo_id={combo_id} ({i}/{len(combos)}) params={params}")
+
+        start_time = time.time()
+        row: Dict[str, Any] = {
+            "combo_id": combo_id,
+            "status": "ok",
+            "error_type": "",
+            "error_msg": "",
+            "traceback_short": "",
+            "duration_s": 0.0,
+        }
+        row.update(params)
+
+        try:
+            # Aplicar overlay
+            rules = apply_overlay(base_rules, params)
+            rules.setdefault("risk_manager", {})["mode"] = config.get("execution", {}).get("mode", "active")
+
+            # Ejecutar backtest
+            metrics = run_single_backtest(rules, effective_seed, config)
+            row.update(metrics)
+
+        except Exception as e:
+            row["status"] = "error"
+            row["error_type"] = type(e).__name__
+            row["error_msg"] = str(e)
+            tb = traceback.format_exc()
+            row["traceback_short"] = tb[-1500:] if len(tb) > 1500 else tb
+
+        row["duration_s"] = round(time.time() - start_time, 2)
+
+        log(f"END combo_id={combo_id} status={row['status']} duration_s={row['duration_s']}")
+
+        # Append to CSV
+        with open(CSV_FILE, "a", newline="", encoding="utf-8") as f:
+            writer = csv.DictWriter(f, fieldnames=csv_headers, extrasaction="ignore")
+            writer.writerow(row)
+
+        results.append(row)
+
+    # Summary
+    ok_count = sum(1 for r in results if r["status"] == "ok")
+    error_count = len(results) - ok_count
+    log(f"DONE: {ok_count} ok, {error_count} errors, total {len(results)}")
+
+    return results
+
+
+# -------------------------------------------------------------------
+# CLI
+# -------------------------------------------------------------------
+def main():
+    parser = argparse.ArgumentParser(description="Run 2B risk calibration grid")
+    parser.add_argument(
+        "--mode",
+        choices=["quick", "full"],
+        default="quick",
+        help="quick: limited combos, full: all combos (default: quick)",
+    )
+    parser.add_argument(
+        "--max-combinations",
+        type=int,
+        default=None,
+        help="Max combinations for quick mode (overrides YAML)",
+    )
+    parser.add_argument(
+        "--seed",
+        type=int,
+        default=42,
+        help="Random seed for reproducibility (default: 42)",
+    )
+
+    args = parser.parse_args()
+
+    run_calibration(
+        mode=args.mode,
+        max_combinations=args.max_combinations,
+        seed=args.seed,
+    )
+
+
+if __name__ == "__main__":
+    main()
